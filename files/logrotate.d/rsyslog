################################################################################
#                                                                              #
#                   ROTADO DE FICHEROS DE LOGS DEL SISTEMA                     #
#                                                                              #
################################################################################

# /var/log/boot.log contiene los mensajes de inicio de sistema generados por
# systemd o el sistema de arranque (init)

/var/log/boot.log {

	# No mostrar error si el archivo no existe
	missingok

	# No rotar si el archivo está vacío
	notifempty

	# Rotar el log semanalmente
	weekly

	# Conservar 5 archivos rotados
	rotate 5

	# No mantener logs de más de 60 días,
	# incluso si no se alcanzan las 5 rotaciones
	maxage 60

	# Solo rotar si el archivo supera 1MB
	minsize 1M

	# Crear el nuevo archivo de log tras la rotación, con permisos 0664,
	# propietario root y grupo root
	create 0664 root root

	# Añadir la fecha como sufijo en el nombre del archivo rotado
	dateext

	# Comprimir los archivos rotados para ahorrar espacio
	compress

}

# /var/log/cron es usado por tareas programadas y sus salidas

/var/log/cron {

	# No mostrar error si el archivo no existe
	missingok

	# No rotar si el archivo está vacío
	notifempty

	# Rotar el log semanalmente
	weekly

	# Conservar 14 archivos rotados
	rotate 14

	# No mantener logs de más de 180 días,
	# incluso si no se alcanzan las 14 rotaciones
	maxage 180

	# Solo rotar si el archivo supera 1MB
	minsize 1M

	# Crear el nuevo archivo de log tras la rotación, con permisos 0664,
	# propietario root y grupo root
	create 0664 root root

	# Añadir la fecha como sufijo en el nombre del archivo rotado
	dateext

	# Comprimir los archivos rotados para ahorrar espacio
	compress

	# Comprimir a partir del segundo archivo rotado (el más reciente no se
	# comprime hasta la siguiente rotación)
	delaycompress

	# El bloque de comando que se ejecuta tras rotar
	postrotate
		# Envía una señal HUP al servicio rsyslog para que vuelva a abrir sus
		# archivos de log tras la rotación (imprescindible para no perder logs)
		/usr/bin/systemctl kill -s HUP rsyslog.service >/dev/null 2>&1 || true
	endscript

}

# /var/log/maillog es usado por servicios de correo

/var/log/maillog {

	# No mostrar error si el archivo no existe
	missingok

	# No rotar si el archivo está vacío
	notifempty

	# Rotar el log semanalmente
	weekly

	# Conservar 14 archivos rotados
	rotate 14

	# No mantener logs de más de 180 días,
	# incluso si no se alcanzan las 14 rotaciones
	maxage 180

	# Solo rotar si el archivo supera 1MB
	minsize 1M

	# Crear el nuevo archivo de log tras la rotación, con permisos 0600,
	# propietario root y grupo root
	create 0600 root root

	# Añadir la fecha como sufijo en el nombre del archivo rotado
	dateext

	# Comprimir los archivos rotados para ahorrar espacio
	compress

	# Comprimir a partir del segundo archivo rotado (el más reciente no se
	# comprime hasta la siguiente rotación)
	delaycompress

	# El bloque de comando que se ejecuta tras rotar
	postrotate
		# Envía una señal HUP al servicio rsyslog para que vuelva a abrir sus
		# archivos de log tras la rotación (imprescindible para no perder logs)
		/usr/bin/systemctl kill -s HUP rsyslog.service >/dev/null 2>&1 || true
	endscript

}

# /var/log/messages contiene mensajes generales del sistema

/var/log/messages {

	# No mostrar error si el archivo no existe
	missingok

	# No rotar si el archivo está vacío
	notifempty

	# Rotar el log semanalmente
	weekly

	# Conservar 14 archivos rotados
	rotate 14

	# No mantener logs de más de 180 días,
	# incluso si no se alcanzan las 14 rotaciones
	maxage 180

	# Crear el nuevo archivo de log tras la rotación, con permisos 0600,
	# propietario root y grupo root
	create 0600 root root

	# Solo rotar si el archivo supera 1MB
	minsize 1M

	# Añadir la fecha como sufijo en el nombre del archivo rotado
	dateext

	# Comprimir los archivos rotados para ahorrar espacio
	compress

	# Comprimir a partir del segundo archivo rotado (el más reciente no se
	# comprime hasta la siguiente rotación)
	delaycompress

	# El bloque de comando que se ejecuta tras rotar
	postrotate
		# Envía una señal HUP al servicio rsyslog para que vuelva a abrir sus
		# archivos de log tras la rotación (imprescindible para no perder logs)
		/usr/bin/systemctl kill -s HUP rsyslog.service >/dev/null 2>&1 || true
	endscript

}

# /var/log/secure registra intentos de acceso, autenticación, sudo, etcétera

/var/log/secure {

	# No mostrar error si el archivo no existe
	missingok

	# No rotar si el archivo está vacío
	notifempty

	# Rotar el log mensualmente
	monthly

	# Conservar 12 archivos rotados
	rotate 12

	# No mantener logs de más de 366 días,
	# incluso si no se alcanzan las 12 rotaciones
	maxage 366

	# Solo rotar si el archivo supera 1MB
	minsize 1M

	# Añadir la fecha como sufijo en el nombre del archivo rotado
	dateext

	# Crear el nuevo archivo de log tras la rotación, con permisos 0600,
	# propietario root y grupo root
	create 0600 root root

	# Comprimir los archivos rotados para ahorrar espacio
	compress

	# Comprimir a partir del segundo archivo rotado (el más reciente no se
	# comprime hasta la siguiente rotación)
	delaycompress

	# El bloque de comando que se ejecuta tras rotar
	postrotate
		# Envía una señal HUP al servicio rsyslog para que vuelva a abrir sus
		# archivos de log tras la rotación (imprescindible para no perder logs)
		/usr/bin/systemctl kill -s HUP rsyslog.service >/dev/null 2>&1 || true
	endscript

}

# /var/log/spooler es usado por sistemas de impresión

/var/log/spooler {

	# No mostrar error si el archivo no existe
	missingok

	# No rotar si el archivo está vacío
	notifempty

	# Rotar el log semanalmente
	weekly

	# Conservar 5 archivos rotados
	rotate 5

	# No mantener logs de más de 60 días,
	# incluso si no se alcanzan las 5 rotaciones
	maxage 60

	# Solo rotar si el archivo supera 1MB
	minsize 1M

	# Crear el nuevo archivo de log tras la rotación, con permisos 0600,
	# propietario root y grupo root
	create 0600 root root

	# Añadir la fecha como sufijo en el nombre del archivo rotado
	dateext

	# Comprimir los archivos rotados para ahorrar espacio
	compress

	# Comprimir a partir del segundo archivo rotado (el más reciente no se
	# comprime hasta la siguiente rotación)
	delaycompress

	# El bloque de comando que se ejecuta tras rotar
	postrotate
		# Envía una señal HUP al servicio rsyslog para que vuelva a abrir sus
		# archivos de log tras la rotación (imprescindible para no perder logs)
		/usr/bin/systemctl kill -s HUP rsyslog.service >/dev/null 2>&1 || true
	endscript

}
